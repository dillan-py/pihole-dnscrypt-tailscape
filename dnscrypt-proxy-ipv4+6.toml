#This is my setup for IPv4 + IPv6 using dnsscrypt resolvers, including a mix of low latency alternatives for redundancy

# Empty listen_addresses to use systemd socket activation


listen_addresses = []


############################################
# RESOLVERS (FAST + SECURE + IPV6)
############################################

server_names = [
  "dnscrypt.uk-ipv4",
  "dnscrypt.uk-ipv6",
  "v.dnscrypt.uk-ipv6",
  "faelix-uk-ipv4",
  "faelix-uk-ipv6",
  "ams-dnscrypt-nl",
  "ams-dnscrypt-nl-ipv6",
  "ffmuc.net",
  "ffmuc.net-v6",
  "faelix-ch-ipv4"
]




lb_strategy = "p2"


############################################
# SECURITY ENFORCEMENT
############################################

require_dnssec = true
dnscrypt_ephemeral_keys = true

require_nolog = false
require_nofilter = false


############################################
# IPV6 SETTINGS
############################################

block_ipv6 = false
ipv6_servers = true


############################################
# BOOTSTRAP / FALLBACK
############################################

bootstrap_resolvers = [
  "9.9.9.9:53",
  "1.1.1.1:53"
]

fallback_resolvers = [
  "9.9.9.9:53",
  "1.1.1.1:53"
]

ignore_system_dns = true


############################################
# CACHE (CRITICAL FOR SPEED)
############################################

cache = true
cache_size = 4096

cache_min_ttl = 300
cache_max_ttl = 86400

cache_neg_min_ttl = 60
cache_neg_max_ttl = 300


############################################
# LEAK PREVENTION / HARDENING
############################################

block_unqualified = true
block_undelegated = true


############################################
# PERFORMANCE TUNING
############################################

timeout = 2500
keepalive = 30
cert_refresh_delay = 240


[query_log]
  file = '/var/log/dnscrypt-proxy/query.log'
#  log_level = 2
[nx_log]
  file = '/var/log/dnscrypt-proxy/nx.log'

#[sources]
 # [sources.'public-resolvers']
  #url = 'https://download.dnscrypt.info/resolvers-list/v2/public-resolvers.md'
  #cache_file = '/var/cache/dnscrypt-proxy/public-resolvers.md'
  #minisign_key = 'RWQf6LRCGA9i53mlYecO4IzT51TGPpvWucNSCh1CBM0QTaLn73Y7GFO3'
  #refresh_delay = 72
  #prefix = ''

[sources]

### An example of a remote source from https://github.com/DNSCrypt/dnscrypt-resolvers

[sources.public-resolvers]
urls = [
  'https://raw.githubusercontent.com/DNSCrypt/dnscrypt-resolvers/master/v3/public-resolvers.md',
  'https://download.dnscrypt.info/resolvers-list/v3/public-resolvers.md',
]
cache_file = 'public-resolvers.md'
minisign_key = 'RWQf6LRCGA9i53mlYecO4IzT51TGPpvWucNSCh1CBM0QTaLn73Y7GFO3'
refresh_delay = 73
prefix = ''
